graph TB
    %% External Services
    subgraph "External Services"
        CLERK[ðŸ” Clerk Auth]
        STRIPE[ðŸ’³ Stripe Payments]
        GROQ[ðŸ¤– Groq API]
        POSTGRES[(ðŸ—„ï¸ PostgreSQL)]
    end

    %% Frontend Layer
    subgraph "Frontend Layer"
        LANDING[ðŸ  Landing Page]
        PRICING[ðŸ’° Pricing Page]
        DASHBOARD[ðŸ“Š User Dashboard]
        ADMIN[âš™ï¸ Admin Panel]
        
        subgraph "Components"
            AUTH_COMP[ðŸ”‘ Auth Components]
            BILLING_COMP[ðŸ’³ Billing Components]
            USAGE_COMP[ðŸ“ˆ Usage Analytics]
            PRICING_COMP[ðŸ’° Pricing Cards]
            ADMIN_COMP[âš™ï¸ Admin Components]
        end
    end

    %% API Layer
    subgraph "API Layer"
        subgraph "Authentication"
            CLERK_WEBHOOK[ðŸ“¨ /api/webhooks/clerk]
        end
        
        subgraph "Payment Processing"
            STRIPE_WEBHOOK[ðŸ“¨ /api/webhooks/stripe]
            CHECKOUT[ðŸ›’ /api/checkout]
            BILLING_PORTAL[ðŸª /api/billing-portal]
        end
        
        subgraph "AI Services"
            CHAT_API[ðŸ¤– /api/openai/v1/chat/completions]
            TOKEN_CONSUME[ðŸª™ Token Consumption]
        end
        
        subgraph "User Management"
            USER_CREDITS[ðŸ’° /api/user/credits]
            USAGE_ANALYTICS[ðŸ“Š /api/user/usage-analytics]
        end
        
        subgraph "Admin APIs"
            ADMIN_PRODUCTS[ðŸ“¦ /api/admin/products]
            ADMIN_STRIPE[âš¡ /api/admin/stripe-sync]
            ADMIN_RULES[âš–ï¸ /api/admin/consumption-rules]
        end
    end

    %% Database Layer
    subgraph "Database Schema"
        USER_DB[(ðŸ‘¤ Users)]
        SUB_DB[(ðŸ“‹ Subscriptions)]
        PRODUCT_DB[(ðŸ“¦ Products)]
        CREDIT_DB[(ðŸ’° Credit Transactions)]
        USAGE_DB[(ðŸ“Š API Usage)]
        TOKEN_RULES[(âš–ï¸ Token Rules)]
        TOKEN_LOGS[(ðŸ“ Token Logs)]
        ANALYTICS_DB[(ðŸ“ˆ Usage Analytics)]
    end

    %% Business Logic Layer
    subgraph "Core Services"
        TOKEN_SERVICE[ðŸª™ Token Consumption Service]
        STRIPE_SERVICE[ðŸ’³ Stripe Integration]
        USER_SERVICE[ðŸ‘¤ User Management]
        ANALYTICS_SERVICE[ðŸ“Š Analytics Engine]
    end

    %% User Flow Connections
    LANDING --> AUTH_COMP
    PRICING --> PRICING_COMP
    DASHBOARD --> USAGE_COMP
    ADMIN --> ADMIN_COMP

    %% Authentication Flow
    AUTH_COMP --> CLERK
    CLERK --> CLERK_WEBHOOK
    CLERK_WEBHOOK --> USER_SERVICE
    USER_SERVICE --> USER_DB
    USER_SERVICE --> STRIPE_SERVICE
    STRIPE_SERVICE --> STRIPE

    %% Payment Flow
    PRICING_COMP --> CHECKOUT
    CHECKOUT --> STRIPE
    STRIPE --> STRIPE_WEBHOOK
    STRIPE_WEBHOOK --> SUB_DB
    STRIPE_WEBHOOK --> CREDIT_DB
    STRIPE_WEBHOOK --> USER_DB

    %% AI Service Flow
    DASHBOARD --> CHAT_API
    CHAT_API --> TOKEN_CONSUME
    TOKEN_CONSUME --> TOKEN_SERVICE
    TOKEN_SERVICE --> TOKEN_RULES
    TOKEN_SERVICE --> USER_CREDITS
    TOKEN_SERVICE --> TOKEN_LOGS
    TOKEN_SERVICE --> GROQ
    GROQ --> CHAT_API

    %% Credit Management
    USER_CREDITS --> CREDIT_DB
    BILLING_COMP --> BILLING_PORTAL
    BILLING_PORTAL --> STRIPE

    %% Analytics Flow
    USAGE_COMP --> USAGE_ANALYTICS
    USAGE_ANALYTICS --> ANALYTICS_SERVICE
    ANALYTICS_SERVICE --> ANALYTICS_DB
    ANALYTICS_SERVICE --> TOKEN_LOGS
    ANALYTICS_SERVICE --> USAGE_DB

    %% Admin Management
    ADMIN_COMP --> ADMIN_PRODUCTS
    ADMIN_COMP --> ADMIN_STRIPE
    ADMIN_COMP --> ADMIN_RULES
    ADMIN_PRODUCTS --> PRODUCT_DB
    ADMIN_STRIPE --> STRIPE
    ADMIN_RULES --> TOKEN_RULES

    %% Database Relationships
    USER_DB --> SUB_DB
    USER_DB --> CREDIT_DB
    USER_DB --> USAGE_DB
    USER_DB --> TOKEN_LOGS
    PRODUCT_DB --> SUB_DB
    TOKEN_RULES --> TOKEN_LOGS

    %% Data Storage
    USER_SERVICE --> POSTGRES
    STRIPE_SERVICE --> POSTGRES
    TOKEN_SERVICE --> POSTGRES
    ANALYTICS_SERVICE --> POSTGRES

    %% Styling
    classDef external fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef frontend fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef api fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef database fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef service fill:#fce4ec,stroke:#880e4f,stroke-width:2px

    class CLERK,STRIPE,GROQ,POSTGRES external
    class LANDING,PRICING,DASHBOARD,ADMIN,AUTH_COMP,BILLING_COMP,USAGE_COMP,PRICING_COMP,ADMIN_COMP frontend
    class CLERK_WEBHOOK,STRIPE_WEBHOOK,CHECKOUT,BILLING_PORTAL,CHAT_API,TOKEN_CONSUME,USER_CREDITS,USAGE_ANALYTICS,ADMIN_PRODUCTS,ADMIN_STRIPE,ADMIN_RULES api
    class USER_DB,SUB_DB,PRODUCT_DB,CREDIT_DB,USAGE_DB,TOKEN_RULES,TOKEN_LOGS,ANALYTICS_DB database
    class TOKEN_SERVICE,STRIPE_SERVICE,USER_SERVICE,ANALYTICS_SERVICE service